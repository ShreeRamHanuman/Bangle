<html>
<head>
  <title>Heart Rate from Bangle.js</title>
</head>
<body>
  <script src="https://www.espruino.com/js/uart.js"></script>
  <script>
    
    // Enable the heart rate sensor on Bangle.js
    UART.eval('Bangle.setHRMPower(1)', function(result) {
      console.log("Heart rate monitor powered on:", result);
    });

   function getHealthHeart() {
    // Get current time
    var currentTime = new Date().toLocaleTimeString();
    console.log("Current Time: ", currentTime);

    // Fetch heart rate using UART.eval
    UART.eval(`
  Bangle.setHRMPower(1)
  Bangle.on('HRM',function(hrm) {
    var d = [
      "H",
      hrm.bpm,
      hrm.confidence
      ];
    Bluetooth.println(d.join(","));
  })
  `), function (d) {
        try {
            // Parse the result (if it is JSON or object-like)
            var data = d; // UART.eval returns an object in most cases
          console.log("UART ",d);

            // Log the heart rate and confidence
            console.log(["H", data.bpm, data.confidence]);

            // Optionally, display the bpm value in an HTML element
            document.getElementById("heartResult").innerHTML = data.bpm;
        } catch (err) {
            console.log("Error processing heart rate data:", err);
        }
    };
}



    // Fetch heart rate every 10 seconds
    setInterval(getHealthHeart, 10000);
  </script>

  <h1>Health Status 07</h1>
  <button onclick="getHealthHeart()">Get Heart Rate</button>
  <br><br>
 Heart Rate:   <span id="heartResult">Heart Rate: Not yet retrieved</span>

</body>
</html>
