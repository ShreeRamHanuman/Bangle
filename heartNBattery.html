<html>
<head>
  <title>Heart Rate from Bangle.js</title>
</head>
<body>
  <script src="https://www.espruino.com/js/uart.js"></script>
  <script>
    
    // Enable the heart rate sensor on Bangle.js
    UART.eval('Bangle.setHRMPower(1)', function(result) {
      console.log("Heart rate monitor powered on:", result);
    });

   function getHealthHeart() {
    // Get current time
    var currentTime = new Date().toLocaleTimeString();
    console.log("Current Time: ", currentTime);
// Define the Bangle.js code to collect HRM data
var BANGLE_CODE = `
Bangle.setHRMPower(1);  // Turn on the Heart Rate Monitor
Bangle.on('HRM', function(hrm) {  // Listen for HRM events
  var d = [
    "H",            // Identifier for heart rate data
    hrm.bpm,        // Beats per minute
    hrm.confidence  // Confidence in the reading
  ];
  Bluetooth.println(d.join(","));  // Send the data via Bluetooth
});
`;

// Send the code to the device via Bluetooth
console.log(UART.eval("\x03\x10if(1){" + BANGLE_CODE + "}\n"));

    

}




    // Fetch heart rate every 10 seconds
    setInterval(getHealthHeart, 10000);
  </script>

  <h1> 007</h1>
  <button onclick="getHealthHeart()">Get Heart Rate</button>
  <br><br>
 Heart Rate:   <span id="heartResult">Heart Rate: Not yet retrieved</span>

</body>
</html>
